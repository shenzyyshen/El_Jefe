<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ user.username }}'s Goal Manager </title>

  <style>
    body {
      background-color: #e0f2fe;
      color: white;
      font-family: Arial, sans-serif;
      padding: 2rem;
    }
    h1 {
      color: #38bdf8;
      margin-bottom: 1rem;
    }
    h2 {
      color: #94a3b8;
      margin-top: 2rem;
      border-bottom: 2px solid #bae6fd;
    }
    .goal-card {
      background: #bae6fd;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      color: #1e293b;
      box-shadow: 0px 6px 10px rgba(0,0,0,0.1)
    }
    .goal-actions {
      margin-top: 0.5rem;
    }
    button {
      background: #0284c7;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 0.5rem;
      color: white;
    }
    button:hover{
      background:#0369a1
    }
    button.delete {
      background: #ef4444;
    }
    button.delete:hover{
      background: #dc2626;
    }
    button.edit {
      background: #fbbf24;
      color: #000;
    }
    button.edit:hover{
      background: #f59e0b;
    }
    input, textarea, select{
      padding: 0.5rem;
      border-radius: 8px;
      border: none;
      margin-right: 0.5rem;
      margin-top:0.3rem;
      background-color: #e2e8f0;
      color: #1e293b
    }

    form {
      margin-bottom: 1rem;
      display: inline;
    }
    .back-link {
      color: #38bdf8;
      display: block;
      margin-top: 2rem;
      text-decoration: none;
    }
    .back-link:hover{
      text-decoration: underline;
    }
    .bar {
      position: relative;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 6px;
    }
    .fill {
      height: 100%;
      background: #0284c7;
      border-radius: 4px;
    }
    .task-count{
      font-size: 0.9rem;
      color:#334155;
      margin-top: 6px;
    }
    .meta {
      font-size:0.9rem;
      color: #334155;
      margin-bottom: 6px;
    }
    .task-item {
      margin-left:1rem; margin-top: 4px;
    }
  </style>
</head>

<body>

    <h1>{{ user.username }}'s Goals</h1>

    <!-- Add Goal -->
    <form method="POST" action="/goal_manager/{{ user.id }}/add">
      <input type="text" name="title" placeholder="New goal title" required />
      <textarea name="description" placeholder="Optional description"></textarea>

      <!-- boss_id-->
      <select name="boss_id" required>
        <option disabled selected>Select Boss</option>
        {% for boss in bosses %}
          <option value="{{ boss.id }}">{{ boss.name }}</option>
        {% endfor %}
      </select>

      <!--goal color -->
      <label> Goal Color:</label>
      <input type="color" name="color" value="#38bdf8"/>

      <button type="submit">Add Goal</button>
    </form>

    <!-- Active Goals -->
    <h2>Active Goals</h2>

    {% set active = false %}

    {% for goal in goals %}
      {% if not goal.completed %}
        {% set active = true %}

        <div class="goal-card" style="border-left: 6px solid;{{ goal.color }};">
        <!--goal header -->
          <strong>{{ goal.title }}</strong>
          <div> Boss: {{ goal.boss_obj.name if goal.boss_obj else "None" }}</div>
          <div>{{ goal.description or "No description provided." }}</div>

          <br>

          <!-- Action buttons-->

          <!--mark complete -->
          <form action="/goal_manager/{{ user.id }}/complete/{{ goal.id }}" method="post">
            <button type="submit>"/>Mark complete</button>
          </form>

          <!--Edit-->
          <form action="/goal_manager/{{ user.id }}/edit/{{ goal.id }}" method="post">
            <input type="text" name="title" value="{{ goal.title }}">
            <input type="text" name="description" value="{{ goal.description}}">
            <button type="submit" class="edit">Save</button>
          </form>

          <!--Delete-->
          <form action="/goal_manager/{{ user.id }}/delete|{{ goal.id }}" method="post">
            <button type="submit" class="delete">Delete</button>
          </form>

          </div>
        {% endif %}
      {% endfor %}

      {% if not active %}
        <p>No active goals yet.</p>
      {% endif %}

      <!-- Completed Goals -->
      <h2>Completed Goals</h2>

      {% set any_completed = false %}
      {% for goal in goals %}
        {% if goal.completed %}
          {% set any_completed = true %}
          <div class="goal-card" style="opacity: 0.9;">
            <strong>{{ goal.title }}</strong><br>
            {{ goal.description or ''}}

              <form action="/goal_manager/ {{ user.id }}/delete/{{ goal.id }}" method="post">
                <button type="submit" class="delete"> Remove</button>
              </form>
            </div>
          {% endif %}
        {% endfor %}

        {% if not any_completed %}
          <p>No completed goals yet.</p>
        {% endif %}

        <a href="/dashboard/{{ user.id }}" class="back-link">â¬… Back to Dashboard</a>

      </body>
      </html>